<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quantum Atomic Model Visualizer | Chemistry Project</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #3e6ae1; /* Tesla blue accent */
        --primary-hover: #5a7fe8;
        --bg-page: #000000; /* Pure black background */
        --bg-panel: #181818;
        --bg-card: #1a1a1a;
        --bg-hover: #222222;
        --text-primary: #ffffff;
        --text-secondary: #a0a0a0;
        --text-muted: #666666;
        --border: #2a2a2a;
        --border-light: #333333;
        --radius-sm: 4px;
        --radius-md: 8px;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: var(--bg-page);
        color: var(--text-primary);
        min-height: 100vh;
        overflow: hidden;
        font-weight: 400;
        letter-spacing: -0.003em;
        display: flex;
        flex-direction: column;
        line-height: 1.5;
      }

      /* Remove animated background; keep page clean */

      .container {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 0 48px 32px;
        max-width: 1600px;
        margin: 0 auto;
      }

      /* Header */
      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 24px 0;
        border-bottom: 1px solid var(--border);
        margin-bottom: 24px;
      }

      .header h1 {
        font-size: 22px;
        font-weight: 500;
        letter-spacing: -0.01em;
        color: var(--text-primary);
        margin: 0;
      }

      .header p {
        font-size: 11px;
        color: var(--text-secondary);
        font-weight: 400;
        margin: 4px 0 0;
      }

      /* Controls */
      .controls {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
        padding: 0 0 24px;
      }

      .btn {
        padding: 10px 20px;
        font-size: 12px;
        font-weight: 500;
        background: var(--bg-panel);
        color: var(--text-primary);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: var(--transition);
        font-family: inherit;
        letter-spacing: 0.01em;
      }

      .btn:hover:not(:disabled) {
        background: var(--bg-hover);
        border-color: var(--border-light);
        transform: translateY(-1px);
      }

      .btn:active:not(:disabled) {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      .btn-secondary {
        background: transparent;
        border-color: var(--border);
      }

      .btn-secondary:hover:not(:disabled) {
        background: var(--bg-panel);
        border-color: var(--border-light);
      }

      select {
        padding: 10px 36px 10px 14px;
        font-size: 12px;
        font-weight: 500;
        background: var(--bg-panel);
        color: var(--text-primary);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: var(--transition);
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a0a0a0' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
      }

      select:hover {
        background: var(--bg-hover);
        border-color: var(--border-light);
      }

      select:focus {
        outline: none;
        border-color: var(--primary);
        background: var(--bg-hover);
      }

      /* Main content layout */
      .main-content {
        display: flex;
        flex: 1;
        gap: 40px;
        align-items: stretch;
        min-height: 0; /* allow flex children to size */
      }

      /* Visualization section */
      .visualization-section {
        flex: 0.9;
        min-width: 0;
        display: flex;
        flex-direction: column;
      }

      .visualization-container {
        position: relative;
        width: 100%;
        flex: 1;
        min-height: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        overflow: hidden;
        margin-bottom: 16px;
      }

      .visualization-container:hover {
        border-color: var(--border-light);
      }

      canvas {
        display: block;
        max-width: 100%;
        height: 100%;
      }

      /* Legend */
      .legend {
        display: flex;
        justify-content: flex-start;
        gap: 20px;
        flex-wrap: wrap;
        padding: 12px 14px;
        background: transparent;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        border-top: 1px solid var(--border);
        margin-top: 8px;
        font-size: 11px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        transition: var(--transition);
      }

      .legend-item:hover {
        color: var(--text-primary);
      }

      .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 2px;
        border: none;
      }

      /* Info Panel */
      .info-section {
        flex: 0.8;
        min-width: 320px;
        display: flex;
        flex-direction: column;
      }

      .info-panel {
        padding: 32px;
        background: var(--bg-card);
        border-radius: var(--radius-md);
        border: 1px solid var(--border);
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .element-name {
        font-size: 32px;
        font-weight: 500;
        margin: 0;
        letter-spacing: -0.015em;
        text-align: left;
        color: var(--text-primary);
      }

      .element-info {
        font-size: 12px;
        margin: 0;
        color: var(--text-secondary);
        font-weight: 400;
        text-align: left;
      }

      .electron-config {
        font-size: 13px;
        font-family: "JetBrains Mono", monospace;
        color: var(--text-primary);
        padding: 12px 14px;
        background: var(--bg-panel);
        border-radius: var(--radius-sm);
        display: block;
        border: 1px solid var(--border);
        font-weight: 400;
        text-align: left;
        letter-spacing: 0.01em;
      }

      .mass-number {
        font-size: 13px;
        color: var(--text-secondary);
        font-weight: 400;
        text-align: left;
        margin: 0;
      }

      .isotope-label {
        font-size: 11px;
        color: var(--text-muted);
        margin: 0;
        font-weight: 400;
        text-align: left;
        line-height: 1.6;
      }

      .isotope-controls {
        display: flex;
        gap: 12px;
      }

      .isotope-controls .btn {
        padding: 10px 20px;
        font-size: 12px;
      }

      /* Responsive */
      @media (max-width: 1200px) {
        .main-content {
          flex-direction: column;
        }
        body {
          overflow-y: auto;
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 0 24px 24px;
        }
        .header h1 {
          font-size: 20px;
        }
        .element-name {
          font-size: 28px;
        }
        .info-panel {
          padding: 24px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Quantum Atomic Model Visualizer</h1>
        <p>Chemically Accurate Atomic Structure with s, and p (Z=1 to Z=20)</p>
      </div>

      <div class="controls">
        <button id="prevBtn" class="btn">← Previous</button>
        <button id="nextBtn" class="btn">Next →</button>
        <select id="elementSelect"></select>
        <button id="playEvolutionBtn" class="btn btn-secondary">
          ▶ Play Evolution
        </button>
        <div class="isotope-controls">
          <button id="addNeutronBtn" class="btn btn-secondary">
            + Neutron
          </button>
          <button id="removeNeutronBtn" class="btn btn-secondary">
            − Neutron
          </button>
        </div>
      </div>

      <div class="main-content">
        <!-- Left: Visualization -->
        <div class="visualization-section">
          <div class="visualization-container">
            <canvas id="atomCanvas" width="1000" height="750"></canvas>
          </div>
        </div>

        <!-- Right: Information -->
        <div class="info-section">
          <div class="info-panel">
            <div class="element-name" id="elementName">Hydrogen</div>
            <div class="element-info" id="elementInfo">
              Atomic Number: 1 | Symbol: H
            </div>
            <div class="electron-config" id="electronConfig">1s¹</div>
            <div class="mass-number" id="massNumber">Mass Number: 1</div>
            <div class="isotope-label" id="isotopeLabel"></div>

            <div class="legend">
              <div class="legend-item">
                <div
                  class="legend-color"
                  style="background: #ef4444; color: #ef4444"
                ></div>
                <span>Protons</span>
              </div>
              <div class="legend-item">
                <div
                  class="legend-color"
                  style="background: #3b82f6; color: #3b82f6"
                ></div>
                <span>Neutrons</span>
              </div>
              <div class="legend-item">
                <div
                  class="legend-color"
                  style="background: #06b6d4; color: #06b6d4"
                ></div>
                <span>s-orbital</span>
              </div>
              <div class="legend-item">
                <div
                  class="legend-color"
                  style="background: #8b5cf6; color: #8b5cf6"
                ></div>
                <span>p-orbital</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Accurate electron configurations with orbital occupancy
      const ELEMENTS = [
        {
          atomicNumber: 1,
          symbol: "H",
          name: "Hydrogen",
          defaultNeutrons: 0,
          stableNeutrons: [0, 1], // 1H, 2H (Deuterium) — Tritium excluded (radioactive)
          electronConfig: "1s¹",
          orbitals: {
            "1s": 1,
            "2s": 0,
            "2px": 0,
            "2py": 0,
            "2pz": 0,
            "3s": 0,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 2,
          symbol: "He",
          name: "Helium",
          defaultNeutrons: 2,
          stableNeutrons: [1, 2], // He-3, He-4
          electronConfig: "1s²",
          orbitals: {
            "1s": 2,
            "2s": 0,
            "2px": 0,
            "2py": 0,
            "2pz": 0,
            "3s": 0,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 3,
          symbol: "Li",
          name: "Lithium",
          defaultNeutrons: 4,
          stableNeutrons: [3, 4], // Li-6, Li-7
          electronConfig: "1s² 2s¹",
          orbitals: {
            "1s": 2,
            "2s": 1,
            "2px": 0,
            "2py": 0,
            "2pz": 0,
            "3s": 0,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 4,
          symbol: "Be",
          name: "Beryllium",
          defaultNeutrons: 5,
          stableNeutrons: [5], // Be-9 only stable
          electronConfig: "1s² 2s²",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 0,
            "2py": 0,
            "2pz": 0,
            "3s": 0,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 5,
          symbol: "B",
          name: "Boron",
          defaultNeutrons: 6,
          stableNeutrons: [5, 6], // B-10, B-11
          electronConfig: "1s² 2s² 2p¹",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 1,
            "2py": 0,
            "2pz": 0,
            "3s": 0,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 6,
          symbol: "C",
          name: "Carbon",
          defaultNeutrons: 6,
          stableNeutrons: [6, 7], // C-12, C-13
          electronConfig: "1s² 2s² 2p²",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 1,
            "2py": 1,
            "2pz": 0,
            "3s": 0,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 7,
          symbol: "N",
          name: "Nitrogen",
          defaultNeutrons: 7,
          stableNeutrons: [7, 8], // N-14, N-15
          electronConfig: "1s² 2s² 2p³",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 1,
            "2py": 1,
            "2pz": 1,
            "3s": 0,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 8,
          symbol: "O",
          name: "Oxygen",
          defaultNeutrons: 8,
          stableNeutrons: [8, 9, 10], // O-16, O-17, O-18
          electronConfig: "1s² 2s² 2p⁴",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 1,
            "2pz": 1,
            "3s": 0,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 9,
          symbol: "F",
          name: "Fluorine",
          defaultNeutrons: 10,
          stableNeutrons: [10], // F-19 only stable
          electronConfig: "1s² 2s² 2p⁵",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 1,
            "3s": 0,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 10,
          symbol: "Ne",
          name: "Neon",
          defaultNeutrons: 10,
          stableNeutrons: [10, 11, 12], // Ne-20, Ne-21, Ne-22
          electronConfig: "1s² 2s² 2p⁶",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 0,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 11,
          symbol: "Na",
          name: "Sodium",
          defaultNeutrons: 12,
          stableNeutrons: [12], // Na-23 only stable
          electronConfig: "1s² 2s² 2p⁶ 3s¹",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 1,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 12,
          symbol: "Mg",
          name: "Magnesium",
          defaultNeutrons: 12,
          stableNeutrons: [12, 13, 14], // Mg-24, Mg-25, Mg-26
          electronConfig: "1s² 2s² 2p⁶ 3s²",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 2,
            "3px": 0,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 13,
          symbol: "Al",
          name: "Aluminum",
          defaultNeutrons: 14,
          stableNeutrons: [14], // Al-27 only stable
          electronConfig: "1s² 2s² 2p⁶ 3s² 3p¹",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 2,
            "3px": 1,
            "3py": 0,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 14,
          symbol: "Si",
          name: "Silicon",
          defaultNeutrons: 14,
          stableNeutrons: [14, 15, 16], // Si-28, Si-29, Si-30
          electronConfig: "1s² 2s² 2p⁶ 3s² 3p²",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 2,
            "3px": 1,
            "3py": 1,
            "3pz": 0,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 15,
          symbol: "P",
          name: "Phosphorus",
          defaultNeutrons: 16,
          stableNeutrons: [16], // P-31 only stable
          electronConfig: "1s² 2s² 2p⁶ 3s² 3p³",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 2,
            "3px": 1,
            "3py": 1,
            "3pz": 1,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 16,
          symbol: "S",
          name: "Sulfur",
          defaultNeutrons: 16,
          stableNeutrons: [16, 17, 18, 20], // S-32, S-33, S-34, S-36
          electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁴",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 2,
            "3px": 2,
            "3py": 1,
            "3pz": 1,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 17,
          symbol: "Cl",
          name: "Chlorine",
          defaultNeutrons: 18,
          stableNeutrons: [18, 20], // Cl-35, Cl-37
          electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁵",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 2,
            "3px": 2,
            "3py": 2,
            "3pz": 1,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 18,
          symbol: "Ar",
          name: "Argon",
          defaultNeutrons: 22,
          stableNeutrons: [18, 20, 22], // Ar-36, Ar-38, Ar-40
          electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 2,
            "3px": 2,
            "3py": 2,
            "3pz": 2,
            "4s": 0,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 19,
          symbol: "K",
          name: "Potassium",
          defaultNeutrons: 20,
          stableNeutrons: [20, 22], // K-39, K-41 (exclude radioactive K-40)
          electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 4s¹",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 2,
            "3px": 2,
            "3py": 2,
            "3pz": 2,
            "4s": 1,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
        {
          atomicNumber: 20,
          symbol: "Ca",
          name: "Calcium",
          defaultNeutrons: 20,
          stableNeutrons: [20, 22, 23, 24, 26, 28], // Ca-40,42,43,44,46,48
          electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 4s²",
          orbitals: {
            "1s": 2,
            "2s": 2,
            "2px": 2,
            "2py": 2,
            "2pz": 2,
            "3s": 2,
            "3px": 2,
            "3py": 2,
            "3pz": 2,
            "4s": 2,
            "3dxy": 0,
            "3dxz": 0,
            "3dyz": 0,
            "3dx²-y²": 0,
            "3dz²": 0,
          },
        },
      ];

      // Application state
      let currentElementIndex = 0;
      let currentNeutrons = 0;
      let animationFrame = null;
      let time = 0;
      let isEvolutionPlaying = false;
      let evolutionInterval = null;

      // Canvas setup
      const canvas = document.getElementById("atomCanvas");
      const ctx = canvas.getContext("2d");

      // Quantum-accurate orbital radii
      const ORBITAL_RADIUS = {
        "1s": 70,
        "2s": 140,
        "2p": 140,
        "3s": 210,
        "3p": 210,
        "3d": 210,
        "4s": 280,
      };

      // Colors
      const COLORS = {
        s: "#06b6d4",
        p: "#8b5cf6",
        d: "#f59e0b",
        electron: "#ffffff",
        proton: "#ef4444",
        neutron: "#3b82f6",
      };

      function init() {
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);

        currentNeutrons = ELEMENTS[currentElementIndex].defaultNeutrons;
        populateElementSelect();
        updateUI();
        animate();

        document
          .getElementById("prevBtn")
          .addEventListener("click", () => changeElement(-1));
        document
          .getElementById("nextBtn")
          .addEventListener("click", () => changeElement(1));
        document
          .getElementById("elementSelect")
          .addEventListener("change", (e) => {
            currentElementIndex = parseInt(e.target.value);
            currentNeutrons = ELEMENTS[currentElementIndex].defaultNeutrons;
            updateUI();
          });
        document
          .getElementById("addNeutronBtn")
          .addEventListener("click", () => modifyNeutrons(1));
        document
          .getElementById("removeNeutronBtn")
          .addEventListener("click", () => modifyNeutrons(-1));
        document
          .getElementById("playEvolutionBtn")
          .addEventListener("click", toggleEvolution);
      }

      function resizeCanvas() {
        const container = canvas.parentElement;
        const rect = container.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
      }

      function populateElementSelect() {
        const select = document.getElementById("elementSelect");
        select.innerHTML = "";
        ELEMENTS.forEach((element, index) => {
          const option = document.createElement("option");
          option.value = index;
          option.textContent = `${element.symbol} - ${element.name}`;
          if (index === currentElementIndex) option.selected = true;
          select.appendChild(option);
        });
      }

      function changeElement(delta) {
        currentElementIndex += delta;
        if (currentElementIndex < 0) currentElementIndex = ELEMENTS.length - 1;
        if (currentElementIndex >= ELEMENTS.length) currentElementIndex = 0;
        currentNeutrons = ELEMENTS[currentElementIndex].defaultNeutrons;
        updateUI();
        populateElementSelect();
      }

      function modifyNeutrons(delta) {
        const element = ELEMENTS[currentElementIndex];
        const allowed = element.stableNeutrons || [element.defaultNeutrons];
        const newNeutrons = currentNeutrons + delta;
        if (allowed.includes(newNeutrons)) {
          currentNeutrons = newNeutrons;
          updateUI();
        }
      }

      function updateUI() {
        const element = ELEMENTS[currentElementIndex];
        document.getElementById("elementName").textContent = element.name;
        document.getElementById(
          "elementInfo"
        ).textContent = `Atomic Number: ${element.atomicNumber} | Symbol: ${element.symbol}`;
        document.getElementById("electronConfig").textContent =
          element.electronConfig;
        const massNumber = element.atomicNumber + currentNeutrons;
        document.getElementById(
          "massNumber"
        ).textContent = `Mass Number: ${massNumber}`;

        // Isotope label
        const stableList = element.stableNeutrons || [element.defaultNeutrons];
        let isotopeText = `${element.symbol}-${massNumber}`;
        if (stableList.includes(currentNeutrons)) {
          isotopeText += " (stable)";
        } else {
          isotopeText += " (unstable)";
        }
        if (stableList.length > 1) {
          isotopeText += ` | Stable neutrons: ${stableList.join(", ")}`;
        }
        const isotopeEl = document.getElementById("isotopeLabel");
        if (isotopeEl) isotopeEl.textContent = isotopeText;

        document.getElementById("prevBtn").disabled =
          currentElementIndex === 0 && !isEvolutionPlaying;
        document.getElementById("nextBtn").disabled =
          currentElementIndex === ELEMENTS.length - 1 && !isEvolutionPlaying;
        document.getElementById("removeNeutronBtn").disabled =
          currentNeutrons === (element.stableNeutrons || [currentNeutrons])[0];
        document.getElementById("addNeutronBtn").disabled =
          currentNeutrons ===
          (element.stableNeutrons || [currentNeutrons])[
            (element.stableNeutrons || [currentNeutrons]).length - 1
          ];
      }

      function toggleEvolution() {
        if (isEvolutionPlaying) {
          stopEvolution();
        } else {
          startEvolution();
        }
      }

      function startEvolution() {
        isEvolutionPlaying = true;
        document.getElementById("playEvolutionBtn").textContent =
          "⏸ Stop Evolution";
        document.getElementById("elementSelect").disabled = true;

        let index = 0;
        evolutionInterval = setInterval(() => {
          currentElementIndex = index;
          currentNeutrons = ELEMENTS[currentElementIndex].defaultNeutrons;
          updateUI();
          populateElementSelect();

          index++;
          if (index >= ELEMENTS.length) {
            stopEvolution();
          }
        }, 2000);
      }

      function stopEvolution() {
        isEvolutionPlaying = false;
        if (evolutionInterval) {
          clearInterval(evolutionInterval);
          evolutionInterval = null;
        }
        document.getElementById("playEvolutionBtn").textContent =
          "▶ Play Evolution";
        document.getElementById("elementSelect").disabled = false;
      }

      // Get electron position on s-orbital
      function getSElectronPosition(radius, electronIndex, totalElectrons, t) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        const spinOffset = electronIndex % 2 === 0 ? 0 : Math.PI;
        const phaseOffset =
          Math.floor(electronIndex / 2) *
          ((2 * Math.PI) / Math.max(Math.ceil(totalElectrons / 2), 1));

        // Smoother, slower animation
        const angle = t * 0.3 + phaseOffset + spinOffset;

        const x = centerX + Math.cos(angle) * radius;
        const y = centerY + Math.sin(angle) * radius;

        return { x, y, spin: electronIndex % 2 === 0 ? 1 : -1 };
      }

      // Get electron position on p-orbital - smooth movement
      // Get electron position on p-orbital - FIXED: smooth tracing of elliptical lobes
      function getPElectronPosition(
        radius,
        orientation,
        electronIndex,
        totalElectrons,
        t
      ) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        const lobeSize = radius * 0.4;
        const nodeDistance = radius * 0.65;

        // Smooth phase offset
        const phaseOffset = electronIndex * 0.4;
        const spinOffset = electronIndex % 2 === 0 ? 0 : Math.PI;

        // Slower, smoother parameter for infinity symbol
        let param = t * 0.35 + phaseOffset + spinOffset;

        // Normalize efficiently
        param = param % (Math.PI * 2);
        if (param < 0) param += Math.PI * 2;

        let x, y;

        if (orientation === "x") {
          const denom = 1 + Math.sin(param) * Math.sin(param);
          x = centerX + (nodeDistance * Math.cos(param)) / denom;
          y = centerY + (lobeSize * Math.sin(param) * Math.cos(param)) / denom;
        } else if (orientation === "y") {
          const denom = 1 + Math.sin(param) * Math.sin(param);
          x = centerX + (lobeSize * Math.sin(param) * Math.cos(param)) / denom;
          y = centerY + (nodeDistance * Math.cos(param)) / denom;
        } else {
          const denom = 1 + Math.sin(param) * Math.sin(param);
          const infX = (nodeDistance * Math.cos(param)) / denom;
          const infY = (lobeSize * Math.sin(param) * Math.cos(param)) / denom;

          const angle45 = Math.PI / 4;
          const cos45 = Math.cos(angle45);
          const sin45 = Math.sin(angle45);
          x = centerX + infX * cos45 - infY * sin45;
          y = centerY + infX * sin45 + infY * cos45;
        }

        return { x, y, spin: electronIndex % 2 === 0 ? 1 : -1 };
      }

      // Get electron position on d-orbital
      function getDElectronPosition(
        radius,
        type,
        electronIndex,
        totalElectrons,
        t
      ) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        const lobeSize = radius * 0.35;
        const lobeDistance = radius * 0.7;
        const phaseOffset = electronIndex * 0.25;
        const spinOffset = electronIndex % 2 === 0 ? 0 : Math.PI;

        let x, y;

        if (type === "dxy" || type === "dxz" || type === "dyz") {
          const baseAngle =
            type === "dxy" ? Math.PI / 4 : type === "dxz" ? 0 : Math.PI / 4;

          // Smoother angle calculation
          let angle = (t * 0.3 + phaseOffset + spinOffset) % (Math.PI * 2);
          if (angle < 0) angle += Math.PI * 2;

          const lobeAngles = [
            baseAngle,
            baseAngle + Math.PI / 2,
            baseAngle + Math.PI,
            baseAngle + (3 * Math.PI) / 2,
          ];

          const nearestLobe = lobeAngles.reduce((prev, curr) => {
            const prevDiff = Math.abs(angle - prev) % (Math.PI * 2);
            const currDiff = Math.abs(angle - curr) % (Math.PI * 2);
            return prevDiff < currDiff ? prev : curr;
          });

          const distance = lobeDistance * (0.8 + 0.2 * Math.sin(angle * 2));
          x = centerX + distance * Math.cos(nearestLobe);
          y = centerY + distance * Math.sin(nearestLobe);
        } else if (type === "dx²-y²") {
          let angle = (t * 0.3 + phaseOffset + spinOffset) % (Math.PI * 2);
          if (angle < 0) angle += Math.PI * 2;

          const lobeAngles = [0, Math.PI / 2, Math.PI, (3 * Math.PI) / 2];

          const nearestLobe = lobeAngles.reduce((prev, curr) => {
            const prevDiff = Math.abs(angle - prev) % (Math.PI * 2);
            const currDiff = Math.abs(angle - curr) % (Math.PI * 2);
            return prevDiff < currDiff ? prev : curr;
          });

          const distance = lobeDistance * (0.8 + 0.2 * Math.sin(angle * 2));
          x = centerX + distance * Math.cos(nearestLobe);
          y = centerY + distance * Math.sin(nearestLobe);
        } else if (type === "dz²") {
          let angle = (t * 0.3 + phaseOffset + spinOffset) % (Math.PI * 2);
          if (angle < 0) angle += Math.PI * 2;

          const donutRadius = lobeDistance * 0.5;
          x = centerX + donutRadius * Math.cos(angle);
          y = centerY + donutRadius * Math.sin(angle);
        }

        return { x, y, spin: electronIndex % 2 === 0 ? 1 : -1 };
      }

      // Render functions (keeping the same as before)
      function renderSOrbital(radius, color) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        ctx.save();
        ctx.strokeStyle = color;
        ctx.globalAlpha = 0.3;
        ctx.lineWidth = 2.5;

        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
        ctx.stroke();

        ctx.globalAlpha = 0.15;
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius * 0.65, 0, Math.PI * 2);
        ctx.stroke();

        ctx.restore();
      }

      function renderPOrbital(radius, orientation, color) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        ctx.save();
        ctx.strokeStyle = color;
        ctx.globalAlpha = 0.35;
        ctx.lineWidth = 2.5;

        const lobeSize = radius * 0.4;
        const nodeDistance = radius * 0.65;

        // Draw infinity symbol using parametric equations
        ctx.beginPath();

        if (orientation === "x") {
          // Horizontal infinity (∞) for px
          for (let t = 0; t <= Math.PI * 2; t += 0.1) {
            // Parametric equation for lemniscate (infinity symbol)
            const denom = 1 + Math.sin(t) * Math.sin(t);
            const x = centerX + (nodeDistance * Math.cos(t)) / denom;
            const y = centerY + (lobeSize * Math.sin(t) * Math.cos(t)) / denom;

            if (t === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }
          }
          ctx.closePath();
          ctx.stroke();
        } else if (orientation === "y") {
          // Vertical infinity (∞ rotated 90°) for py
          for (let t = 0; t <= Math.PI * 2; t += 0.1) {
            const denom = 1 + Math.sin(t) * Math.sin(t);
            const x = centerX + (lobeSize * Math.sin(t) * Math.cos(t)) / denom;
            const y = centerY + (nodeDistance * Math.cos(t)) / denom;

            if (t === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }
          }
          ctx.closePath();
          ctx.stroke();
        } else {
          // Diagonal infinity (pz) - rotated 45 degrees
          for (let t = 0; t <= Math.PI * 2; t += 0.1) {
            const denom = 1 + Math.sin(t) * Math.sin(t);
            const infX = (nodeDistance * Math.cos(t)) / denom;
            const infY = (lobeSize * Math.sin(t) * Math.cos(t)) / denom;

            // Rotate 45 degrees
            const angle45 = Math.PI / 4;
            const cos45 = Math.cos(angle45);
            const sin45 = Math.sin(angle45);
            const x = centerX + infX * cos45 - infY * sin45;
            const y = centerY + infX * sin45 + infY * cos45;

            if (t === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }
          }
          ctx.closePath();
          ctx.stroke();
        }

        ctx.restore();
      }

      function renderDOrbital(radius, type, color) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        ctx.save();
        ctx.strokeStyle = color;
        ctx.globalAlpha = 0.35;
        ctx.lineWidth = 2.5;

        const lobeSize = radius * 0.35;
        const lobeDistance = radius * 0.7;

        if (type === "dxy" || type === "dxz" || type === "dyz") {
          const angles =
            type === "dxy"
              ? [
                  Math.PI / 4,
                  (3 * Math.PI) / 4,
                  (5 * Math.PI) / 4,
                  (7 * Math.PI) / 4,
                ]
              : type === "dxz"
              ? [0, Math.PI / 2, Math.PI, (3 * Math.PI) / 2]
              : [
                  Math.PI / 4,
                  (3 * Math.PI) / 4,
                  (5 * Math.PI) / 4,
                  (7 * Math.PI) / 4,
                ];

          angles.forEach((angle) => {
            const x = centerX + lobeDistance * Math.cos(angle);
            const y = centerY + lobeDistance * Math.sin(angle);
            ctx.beginPath();
            ctx.ellipse(x, y, lobeSize, lobeSize * 0.5, angle, 0, Math.PI * 2);
            ctx.stroke();
          });
        } else if (type === "dx²-y²") {
          const angles = [0, Math.PI / 2, Math.PI, (3 * Math.PI) / 2];
          angles.forEach((angle) => {
            const x = centerX + lobeDistance * Math.cos(angle);
            const y = centerY + lobeDistance * Math.sin(angle);
            ctx.beginPath();
            ctx.ellipse(x, y, lobeSize, lobeSize * 0.5, angle, 0, Math.PI * 2);
            ctx.stroke();
          });
        } else if (type === "dz²") {
          ctx.globalAlpha = 0.25;
          ctx.beginPath();
          ctx.arc(centerX, centerY, lobeDistance * 0.5, 0, Math.PI * 2);
          ctx.stroke();

          ctx.globalAlpha = 0.35;
          ctx.beginPath();
          ctx.ellipse(
            centerX,
            centerY - lobeDistance * 0.7,
            lobeSize * 0.5,
            lobeSize,
            0,
            0,
            Math.PI * 2
          );
          ctx.stroke();
          ctx.beginPath();
          ctx.ellipse(
            centerX,
            centerY + lobeDistance * 0.7,
            lobeSize * 0.5,
            lobeSize,
            0,
            0,
            Math.PI * 2
          );
          ctx.stroke();
        }

        ctx.restore();
      }

      function renderElectrons() {
        const element = ELEMENTS[currentElementIndex];

        ctx.save();

        ["1s", "2s", "3s", "4s"].forEach((orbital) => {
          const count = element.orbitals[orbital] || 0;
          if (count > 0) {
            const radius = ORBITAL_RADIUS[orbital];
            for (let i = 0; i < count; i++) {
              const pos = getSElectronPosition(radius, i, count, time);

              ctx.fillStyle = COLORS.electron;
              ctx.globalAlpha = 0.95;
              ctx.shadowBlur = 20;
              ctx.shadowColor = COLORS.s;

              ctx.beginPath();
              ctx.arc(pos.x, pos.y, 6, 0, Math.PI * 2);
              ctx.fill();

              ctx.strokeStyle = pos.spin > 0 ? "#10b981" : "#f59e0b";
              ctx.lineWidth = 2;
              ctx.globalAlpha = 0.9;
              ctx.beginPath();
              ctx.moveTo(pos.x - 4, pos.y - 4);
              ctx.lineTo(pos.x + 4, pos.y - 4);
              if (pos.spin > 0) {
                ctx.lineTo(pos.x + 2, pos.y - 6);
              } else {
                ctx.lineTo(pos.x - 2, pos.y - 6);
              }
              ctx.stroke();
            }
          }
        });

        [
          { name: "2px", radius: ORBITAL_RADIUS["2p"], orient: "x" },
          { name: "2py", radius: ORBITAL_RADIUS["2p"], orient: "y" },
          { name: "2pz", radius: ORBITAL_RADIUS["2p"], orient: "z" },
          { name: "3px", radius: ORBITAL_RADIUS["3p"], orient: "x" },
          { name: "3py", radius: ORBITAL_RADIUS["3p"], orient: "y" },
          { name: "3pz", radius: ORBITAL_RADIUS["3p"], orient: "z" },
        ].forEach(({ name, radius, orient }) => {
          const count = element.orbitals[name] || 0;
          if (count > 0) {
            for (let i = 0; i < count; i++) {
              const pos = getPElectronPosition(radius, orient, i, count, time);

              ctx.fillStyle = COLORS.electron;
              ctx.globalAlpha = 0.95;
              ctx.shadowBlur = 20;
              ctx.shadowColor = COLORS.p;

              ctx.beginPath();
              ctx.arc(pos.x, pos.y, 6, 0, Math.PI * 2);
              ctx.fill();

              ctx.strokeStyle = pos.spin > 0 ? "#10b981" : "#f59e0b";
              ctx.lineWidth = 2;
              ctx.globalAlpha = 0.9;
              ctx.beginPath();
              ctx.moveTo(pos.x - 4, pos.y - 4);
              ctx.lineTo(pos.x + 4, pos.y - 4);
              if (pos.spin > 0) {
                ctx.lineTo(pos.x + 2, pos.y - 6);
              } else {
                ctx.lineTo(pos.x - 2, pos.y - 6);
              }
              ctx.stroke();
            }
          }
        });

        [
          { name: "3dxy", radius: ORBITAL_RADIUS["3d"], type: "dxy" },
          { name: "3dxz", radius: ORBITAL_RADIUS["3d"], type: "dxz" },
          { name: "3dyz", radius: ORBITAL_RADIUS["3d"], type: "dyz" },
          { name: "3dx²-y²", radius: ORBITAL_RADIUS["3d"], type: "dx²-y²" },
          { name: "3dz²", radius: ORBITAL_RADIUS["3d"], type: "dz²" },
        ].forEach(({ name, radius, type }) => {
          const count = element.orbitals[name] || 0;
          if (count > 0) {
            for (let i = 0; i < count; i++) {
              const pos = getDElectronPosition(radius, type, i, count, time);

              ctx.fillStyle = COLORS.electron;
              ctx.globalAlpha = 0.95;
              ctx.shadowBlur = 20;
              ctx.shadowColor = COLORS.d;

              ctx.beginPath();
              ctx.arc(pos.x, pos.y, 6, 0, Math.PI * 2);
              ctx.fill();

              ctx.strokeStyle = pos.spin > 0 ? "#10b981" : "#f59e0b";
              ctx.lineWidth = 2;
              ctx.globalAlpha = 0.9;
              ctx.beginPath();
              ctx.moveTo(pos.x - 4, pos.y - 4);
              ctx.lineTo(pos.x + 4, pos.y - 4);
              if (pos.spin > 0) {
                ctx.lineTo(pos.x + 2, pos.y - 6);
              } else {
                ctx.lineTo(pos.x - 2, pos.y - 6);
              }
              ctx.stroke();
            }
          }
        });

        ctx.shadowBlur = 0;
        ctx.restore();
      }

      function renderNucleus() {
        const element = ELEMENTS[currentElementIndex];
        const protons = element.atomicNumber;
        const totalNucleons = protons + currentNeutrons;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        ctx.save();

        const nucleusRadius = 18 + Math.sqrt(totalNucleons) * 2.5;
        const gradient = ctx.createRadialGradient(
          centerX,
          centerY,
          0,
          centerX,
          centerY,
          nucleusRadius
        );
        gradient.addColorStop(0, "rgba(239, 68, 68, 0.8)");
        gradient.addColorStop(1, "rgba(239, 68, 68, 0.2)");

        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(centerX, centerY, nucleusRadius, 0, Math.PI * 2);
        ctx.fill();

        const nucleonRadius = 3;
        let index = 0;

        for (let i = 0; i < protons; i++) {
          const angle = (index * 2 * Math.PI) / Math.max(totalNucleons, 1);
          const radius = Math.min(12, Math.sqrt(totalNucleons) * 2);
          const x = centerX + Math.cos(angle) * radius;
          const y = centerY + Math.sin(angle) * radius;

          ctx.fillStyle = COLORS.proton;
          ctx.beginPath();
          ctx.arc(x, y, nucleonRadius, 0, Math.PI * 2);
          ctx.fill();
          index++;
        }

        for (let i = 0; i < currentNeutrons; i++) {
          const angle = (index * 2 * Math.PI) / Math.max(totalNucleons, 1);
          const radius = Math.min(12, Math.sqrt(totalNucleons) * 2);
          const x = centerX + Math.cos(angle) * radius;
          const y = centerY + Math.sin(angle) * radius;

          ctx.fillStyle = COLORS.neutron;
          ctx.beginPath();
          ctx.arc(x, y, nucleonRadius, 0, Math.PI * 2);
          ctx.fill();
          index++;
        }

        ctx.restore();
      }

      function render() {
        const element = ELEMENTS[currentElementIndex];

        ctx.fillStyle = "rgba(10, 14, 39, 0.95)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (element.orbitals["1s"] > 0)
          renderSOrbital(ORBITAL_RADIUS["1s"], COLORS.s);
        if (element.orbitals["2s"] > 0)
          renderSOrbital(ORBITAL_RADIUS["2s"], COLORS.s);
        if (element.orbitals["3s"] > 0)
          renderSOrbital(ORBITAL_RADIUS["3s"], COLORS.s);
        if (element.orbitals["4s"] > 0)
          renderSOrbital(ORBITAL_RADIUS["4s"], COLORS.s);

        if (
          element.orbitals["2px"] > 0 ||
          element.orbitals["2py"] > 0 ||
          element.orbitals["2pz"] > 0
        ) {
          if (element.orbitals["2px"] > 0)
            renderPOrbital(ORBITAL_RADIUS["2p"], "x", COLORS.p);
          if (element.orbitals["2py"] > 0)
            renderPOrbital(ORBITAL_RADIUS["2p"], "y", COLORS.p);
          if (element.orbitals["2pz"] > 0)
            renderPOrbital(ORBITAL_RADIUS["2p"], "z", COLORS.p);
        }

        if (
          element.orbitals["3px"] > 0 ||
          element.orbitals["3py"] > 0 ||
          element.orbitals["3pz"] > 0
        ) {
          if (element.orbitals["3px"] > 0)
            renderPOrbital(ORBITAL_RADIUS["3p"], "x", COLORS.p);
          if (element.orbitals["3py"] > 0)
            renderPOrbital(ORBITAL_RADIUS["3p"], "y", COLORS.p);
          if (element.orbitals["3pz"] > 0)
            renderPOrbital(ORBITAL_RADIUS["3p"], "z", COLORS.p);
        }

        if (element.orbitals["3dxy"] > 0)
          renderDOrbital(ORBITAL_RADIUS["3d"], "dxy", COLORS.d);
        if (element.orbitals["3dxz"] > 0)
          renderDOrbital(ORBITAL_RADIUS["3d"], "dxz", COLORS.d);
        if (element.orbitals["3dyz"] > 0)
          renderDOrbital(ORBITAL_RADIUS["3d"], "dyz", COLORS.d);
        if (element.orbitals["3dx²-y²"] > 0)
          renderDOrbital(ORBITAL_RADIUS["3d"], "dx²-y²", COLORS.d);
        if (element.orbitals["3dz²"] > 0)
          renderDOrbital(ORBITAL_RADIUS["3d"], "dz²", COLORS.d);

        renderElectrons();
        renderNucleus();
      }

      function animate() {
        time += 0.016;
        render();
        animationFrame = requestAnimationFrame(animate);
      }

      window.addEventListener("load", init);
    </script>
  </body>
</html>
